<!-- src/app/pages/admin/clientes/clientes.html -->
<div class="clientes-page">
  <ng-container *ngIf="!showForm; else formView">
    <!-- Toolbar superior -->
    <div class="toolbar">
      <div class="title-wrap">
        <h1 class="title">Lista de clientes</h1>
        <span class="accent"></span>
      </div>

      <button type="button" class="back-link" (click)="goBack()">Regresar</button>
    </div>

    <!-- Acciones -->
    <div class="actions">
      <button type="button" class="btn-primary" (click)="newClient()">
        <i class="fa-solid fa-user-plus"></i>
        <span>Nuevo cliente</span>
      </button>
    </div>

    <!-- Estado de carga / error -->
    <div class="content">
      <div *ngIf="loading" class="loading">
        <i class="fa-solid fa-spinner fa-spin"></i> Cargando clientes...
      </div>

      <div *ngIf="!loading && loadError" class="error">
        <i class="fa-solid fa-triangle-exclamation"></i> {{ loadError }}
      </div>

      <!-- Tabla -->
      <table class="client-table" *ngIf="!loading && !loadError && clients.length > 0">
        <thead>
          <tr>
            <th>N</th>
            <th>Nombre del cliente</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let client of clients; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ client.nombre }} {{ client.apellido }}</td>
            <td class="actions-cell">
              <button class="btn-view" (click)="openInfo(client)">
                <i class="fa-solid fa-eye"></i> Ver
              </button>
              <button class="btn-delete" (click)="openDeleteConfirm(client)">
                <i class="fa-solid fa-trash"></i> Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Vacío -->
      <div class="empty" *ngIf="!loading && !loadError && clients.length === 0">
        <i class="fa-solid fa-user-slash"></i>
        <p>No hay clientes registrados.</p>
      </div>
    </div>
  </ng-container>
</div>

<!-- ================= MODAL DE CONFIRMACIÓN ================= -->
<div class="modal-overlay" *ngIf="isConfirmOpen" (keydown.escape)="closeConfirm()" role="dialog" aria-modal="true"
  aria-labelledby="confirm-title" aria-describedby="confirm-desc">
  <div class="modal">
    <div class="modal-header">
      <h3 id="confirm-title">
        <i class="fa-solid fa-triangle-exclamation"></i>
        Confirmar eliminación
      </h3>
      <button class="icon-close" (click)="closeConfirm()" aria-label="Cerrar">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <div class="modal-body" id="confirm-desc">
      ¿Seguro que deseas eliminar a
      <strong>{{ clientToDelete?.nombre }} {{ clientToDelete?.apellido }}</strong>?
      <br />
      <small>Esta acción no se puede deshacer.</small>
    </div>

    <div class="modal-footer">
      <button id="confirm-cancel" class="btn-ghost" (click)="closeConfirm()">Cancelar</button>
      <button class="btn-danger" (click)="confirmDelete()">
        <i class="fa-solid fa-trash"></i>
        Eliminar
      </button>
    </div>
  </div>
</div>

<app-modal-info
  [open]="isInfoOpen"
  [client]="clientToView"
  (close)="closeInfo()">
</app-modal-info>

<!-- ====== VISTA FORMULARIO NUEVO CLIENTE ====== -->
<ng-template #formView>
  <app-new-client (close)="closeForm()"></app-new-client>
</ng-template>
